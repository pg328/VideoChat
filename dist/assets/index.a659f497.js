var e=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable;import{q as a,f as n,r,B as c,S as l,L as s,T as i,a as d,b as p}from"./vendor.ad2da8b1.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const a=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,r)=>{const c=new URL(e,a);if(self[t].moduleMap[c])return o(self[t].moduleMap[c]);const l=new Blob([`import * as m from '${c}';`,`${t}.moduleMap['${c}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){r(new Error(`Failed to import: ${e}`)),n(s)},onload(){o(self[t].moduleMap[c]),n(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/assets/");const m={apiKey:"AIzaSyACAdlUJqq_FYg5beq2FG_GLExWvmGRCAU",authDomain:"philvidchat.firebaseapp.com",projectId:"philvidchat",storageBucket:"philvidchat.appspot.com",messagingSenderId:"564284935763",appId:"1:564284935763:web:6385d3814826d24f2540a6"},g="#F3A712",u="#A8C686",f=()=>{n.apps.length||n.initializeApp(m);const e=n.firestore(),t=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10});let o=null,a=null;const s=r.useRef(),i=r.useRef(),d=r.useRef(),p=window.location.href.split("/")[3];t.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{a.addTrack(e),console.log(a)}))},r.useEffect((async()=>{await(async()=>{o=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),a=new MediaStream,o.getTracks().forEach((e=>{t.addTrack(e,o)})),s.current.srcObject=o,i.current.srcObject=a})(),p?await u():await g()}));const g=async()=>{const o=e.collection("calls").doc(),a=o.collection("offerCandidates"),n=o.collection("answerCandidates");d.current=o.id,console.log(`Code: ${d.current}`),console.log("1. Creating ICE candidate listener"),t.onicecandidate=e=>{console.log("4. New (Offer) ICE Candidate Event"),console.log(e),e.candidate&&a.add(e.candidate.toJSON())},console.log("2. Created!"),console.log("3. Offer Creation");const r=await t.createOffer();await t.setLocalDescription(r);const c={sdp:r.sdp,type:r.type};await o.set({offer:c}),console.log("5. Set the offer"),o.onSnapshot((e=>{const o=e.data();if(!t.currentRemoteDescription&&(null==o?void 0:o.answer)){const e=new RTCSessionDescription(o.answer);t.setRemoteDescription(e),console.log("Data.Answer Updated!")}})),n.onSnapshot((e=>{console.log("New Answer Candidate Snapshot!"),console.log(e.docChanges()),e.docChanges().forEach((e=>{if(console.log("Change has happened..."),"added"===e.type){console.log("The change was an addition!");const o=new RTCIceCandidate(e.doc.data());t.addIceCandidate(o),console.log("Answered!")}}))}))},u=async()=>{const o=p,a=e.collection("calls").doc(o),n=a.collection("offerCandidates"),r=a.collection("answerCandidates");console.log("1. Creating ICE candidate listener"),t.onicecandidate=e=>{console.log("4/5. New (Answer) ICE Candidate Event"),console.log(e),e.candidate&&r.add(e.candidate.toJSON())},console.log("2. Created!");const c=(await a.get()).data();console.log("3. Offer Description");const l=c.offer;await t.setRemoteDescription(new RTCSessionDescription(l)),console.log("4. Answer Description");const s=await t.createAnswer();await t.setLocalDescription(s);const i={type:s.type,sdp:s.sdp};await a.update({answer:i}),console.log("6. Answer Updated!"),n.onSnapshot((e=>{console.log("New Offer Candidate Snapshot"),console.log(e.docChanges()),e.docChanges().forEach((e=>{if(console.log("New doc Change"),"added"===e.type){console.log("Change was an addition");let o=e.doc.data();t.addIceCandidate(new RTCIceCandidate(o)),console.log("ICE candidate Added!")}}))}))};return r.createElement(c,{a11yTitle:"Body",fill:!0},!p&&r.createElement(h,{tr:d}),r.createElement(c,null,r.createElement(l,{anchor:"top-right"},r.createElement(c,null,r.createElement("video",{"aria-label":"Remote Stream",autoPlay:!0,playsInline:!0,ref:i})),r.createElement(c,{width:"small"},r.createElement(w,{"aria-label":"Local Stream",autoPlay:!0,muted:!0,playsInline:!0,ref:s})))))},w=a.video`
& {
	transform: rotateY(180deg);
	-webkit-transform:rotateY(180deg);
	-moz-transform:rotateY(180deg);}
`,h=a=>{var{tr:n}=a;((a,n)=>{var r={};for(var c in a)e.call(a,c)&&n.indexOf(c)<0&&(r[c]=a[c]);if(null!=a&&t)for(var c of t(a))n.indexOf(c)<0&&o.call(a,c)&&(r[c]=a[c])})(a,["tr"]);const[l,p]=r.useState(!0);return r.createElement(c,null,l&&r.createElement(s,{responsive:!0,position:"center"},r.createElement(c,{background:g,round:"small"},r.createElement(c,{round:"medium",width:"large",direction:"row",justify:"center",align:"center"},r.createElement(i,null,"Psst, here's a lil link to send to ur pals 😏😏: ")),r.createElement(c,{round:"medium",width:"large",direction:"row",justify:"center",align:"center"},r.createElement(c,{elevation:"medium",background:u,round:"medium"},r.createElement(d,{label:r.createElement(i,{weight:500},"(Click me to copy the link 😎)"),plain:!0,onClick:()=>{navigator.clipboard.writeText(window.location.href+n.current),console.log(n.current.length),p(!1)}}))))))};p.render(r.createElement(r.StrictMode,null,r.createElement(f,null)),document.getElementById("root"));
